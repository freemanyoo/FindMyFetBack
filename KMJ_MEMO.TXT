-- 데이터베이스 사용
USE webdb;

-- 기존 테이블이 있다면 삭제 (선택사항)
-- DROP TABLE IF EXISTS find_pet_posts;

-- find_pet_posts 테이블 생성 (테이블명 변경)
CREATE TABLE find_pet_posts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT COMMENT '내용',
    author VARCHAR(50) NOT NULL COMMENT '작성자',
    lost_date DATE COMMENT '분실 날짜',
    city_province VARCHAR(20) COMMENT '시·도',
    district VARCHAR(30) COMMENT '군/구',
    animal_type VARCHAR(20) COMMENT '동물 종류 (DOG, CAT, OTHER)',
    breed VARCHAR(50) COMMENT '품종',
    gender VARCHAR(20) COMMENT '성별 (MALE, FEMALE, UNKNOWN)',
    is_found BOOLEAN DEFAULT FALSE COMMENT '검색 완료 여부',
    contact VARCHAR(50) COMMENT '연락처',
    image_url VARCHAR(500) COMMENT '이미지 URL',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='분실 반려동물 신고 게시판';

-- 인덱스 생성 (검색 성능 향상)
CREATE INDEX idx_find_pet_posts_city_province ON find_pet_posts(city_province);
CREATE INDEX idx_find_pet_posts_district ON find_pet_posts(district);
CREATE INDEX idx_find_pet_posts_animal_type ON find_pet_posts(animal_type);
CREATE INDEX idx_find_pet_posts_breed ON find_pet_posts(breed);
CREATE INDEX idx_find_pet_posts_gender ON find_pet_posts(gender);
CREATE INDEX idx_find_pet_posts_is_found ON find_pet_posts(is_found);
CREATE INDEX idx_find_pet_posts_lost_date ON find_pet_posts(lost_date);
CREATE INDEX idx_find_pet_posts_created_at ON find_pet_posts(created_at);
CREATE INDEX idx_find_pet_posts_title ON find_pet_posts(title);
CREATE INDEX idx_find_pet_posts_author ON find_pet_posts(author);

-- 복합 인덱스 추가 (자주 함께 사용되는 조건들)
CREATE INDEX idx_find_pet_posts_location ON find_pet_posts(city_province, district);
CREATE INDEX idx_find_pet_posts_animal_info ON find_pet_posts(animal_type, breed);
CREATE INDEX idx_find_pet_posts_status_date ON find_pet_posts(is_found, created_at);

-- 샘플 데이터 삽입
INSERT INTO find_pet_posts (
    title, content, author, lost_date, city_province, district,
    animal_type, breed, gender, is_found, contact
) VALUES
(
    '강남구에서 분실된 골든리트리버 찾습니다',
    '3살 수컷 골든리트리버가 강남역 근처에서 분실되었습니다. 목걸이를 착용하고 있었습니다.',
    '김철수',
    '2024-08-19',
    '서울특별시',
    '강남구',
    'DOG',
    '골든리트리버',
    'MALE',
    FALSE,
    '010-1234-5678'
),
(
    '해운대구에서 분실된 페르시안 고양이',
    '2살 암컷 페르시안 고양이입니다. 털이 길고 하얀색입니다.',
    '이영희',
    '2024-08-21',
    '부산광역시',
    '해운대구',
    'CAT',
    '페르시안',
    'FEMALE',
    FALSE,
    '010-9876-5432'
),
(
    '중구에서 분실된 비글 찾았습니다!',
    '며칠 전 분실신고했던 비글을 찾았습니다. 도와주신 모든 분들께 감사드립니다.',
    '박민수',
    '2024-08-15',
    '대구광역시',
    '중구',
    'DOG',
    '비글',
    'MALE',
    TRUE,
    '010-5555-7777'
),
(
    '연수구에서 분실된 토끼',
    '하얀색 드워프 토끼가 분실되었습니다. 작고 귀여운 아이입니다.',
    '최지훈',
    '2024-08-20',
    '인천광역시',
    '연수구',
    'OTHER',
    '드워프',
    'UNKNOWN',
    FALSE,
    '010-2222-8888'
),
(
    '마포구 홍대 근처에서 분실된 시바견',
    '갈색 시바견이 홍익대학교 근처에서 분실되었습니다.',
    '정수진',
    '2024-08-17',
    '서울특별시',
    '마포구',
    'DOG',
    '시바견',
    'FEMALE',
    FALSE,
    '010-7777-3333'
),
(
    '부산진구에서 분실된 말티즈',
    '흰색 말티즈 암컷입니다. 빨간색 목걸이를 하고 있었습니다.',
    '윤서영',
    '2024-08-22',
    '부산광역시',
    '부산진구',
    'DOG',
    '말티즈',
    'FEMALE',
    FALSE,
    '010-3333-9999'
),
(
    '광주 서구에서 분실된 러시안블루 고양이',
    '회색 러시안블루 고양이입니다. 매우 수줍음이 많습니다.',
    '조민호',
    '2024-08-23',
    '광주광역시',
    '서구',
    'CAT',
    '러시안블루',
    'MALE',
    FALSE,
    '010-4444-1111'
);

-- 테이블 구조 확인
DESCRIBE find_pet_posts;

-- 데이터 확인
SELECT * FROM find_pet_posts ORDER BY created_at DESC;

-- 데이터 통계 확인
SELECT COUNT(*) as total_posts FROM find_pet_posts;
SELECT animal_type, COUNT(*) as count FROM find_pet_posts GROUP BY animal_type;
SELECT city_province, COUNT(*) as count FROM find_pet_posts GROUP BY city_province ORDER BY count DESC;
SELECT is_found, COUNT(*) as count FROM find_pet_posts GROUP BY is_found;

-- 검색 테스트 쿼리들
-- 1. 제목으로 검색
SELECT * FROM find_pet_posts WHERE title LIKE '%골든%' ORDER BY created_at DESC;

-- 2. 지역으로 검색
SELECT * FROM find_pet_posts WHERE city_province = '서울특별시' ORDER BY created_at DESC;

-- 3. 동물 타입으로 검색
SELECT * FROM find_pet_posts WHERE animal_type = 'DOG' ORDER BY created_at DESC;

-- 4. 검색 완료 상태로 필터링
SELECT * FROM find_pet_posts WHERE is_found = FALSE ORDER BY created_at DESC;

-- 5. 복합 검색 (지역 + 동물 타입)
SELECT * FROM find_pet_posts
WHERE city_province = '부산광역시' AND animal_type = 'DOG'
ORDER BY created_at DESC;

-- 테이블 삭제 (필요시)
-- DROP TABLE IF EXISTS find_pet_posts;

-- 이전 테이블 삭제 (기존 lost_pet_posts 테이블이 있는 경우)
-- DROP TABLE IF EXISTS lost_pet_posts;