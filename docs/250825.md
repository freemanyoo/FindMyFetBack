# `찾아줘요` 프로젝트 백엔드 코드 요약 (Post 기능 중심)

**문서 버전: 1.0**
**작성일: 2025-08-25**

본 문서는 `찾아줘요` 프로젝트의 백엔드, 특히 **게시글(Post) 관련 기능**에 대한 현재까지의 모든 코드 내용을 클래스별로 정리한 요약본입니다. 각 클래스의 기능 정의, 주요 메소드 설명, 그리고 개발 과정에서 논의되었던 주요 Q&A를 포함하고 있습니다.

## 1. 클래스별 기능 및 주요 메소드 정리

### Ⅰ. 설정 관련 클래스 (`Configuration`)

#### 1. `RootConfig.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/config/RootConfig.java`
- **기능 정의**: 프로젝트 전반에 사용될 공통 설정 및 Bean을 등록합니다.
- **주요 메소드**:
    - `getMapper()`: Entity와 DTO 간의 데이터 변환을 용이하게 해주는 `ModelMapper` Bean을 생성하고 설정합니다.

#### 2. `SwaggerConfig.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/config/SwaggerConfig.java`
- **기능 정의**: Swagger UI를 통해 개발된 API를 시각적으로 문서화하고, 직접 테스트할 수 있는 환경을 설정합니다. JWT 인증을 테스트할 수 있도록 Security 설정을 포함합니다.
- **주요 메소드**:
    - `openAPI()`: API 문서의 기본 정보(제목, 설명, 버전)를 설정하고, JWT 인증(Bearer Token)을 위한 SecurityScheme을 등록합니다.

### Ⅱ. 도메인 계층 (`Domain` - Entities & Enums)

#### 1. `Post.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/domain/post/Post.java`
- **기능 정의**: 게시글의 핵심 정보를 데이터베이스 `post` 테이블과 매핑하는 엔티티 클래스입니다. `User` 및 `Image` 엔티티와 연관관계를 맺고 있습니다.
- **주요 메소드**:
    - `setUser(User user)`: 게시글과 작성자(`User`)의 연관관계를 설정합니다.
    - `addImage(Image image)`: 게시글에 이미지를 추가하고, 이미지 객체에도 게시글 정보를 설정하는 연관관계 편의 메소드입니다.
    - `update(...)`: 게시글의 내용을 수정하는 비즈니스 로직입니다. JPA의 더티 체킹(Dirty Checking)을 통해 호출 시 자동으로 DB에 변경사항이 반영됩니다.
    - `complete()`: 게시글의 상태를 '완료(COMPLETED)'로 변경하는 비즈니스 로직입니다.

#### 2. `Image.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/domain/post/Image.java`
- **기능 정의**: 업로드된 이미지 파일의 정보(URL)를 데이터베이스 `image` 테이블과 매핑하는 엔티티입니다.
- **주요 메소드**:
    - `setPost(Post post)`: 이미지와 게시글(`Post`)의 연관관계를 설정합니다.

#### 3. `User.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/domain/User.java`
- **기능 정의**: 사용자 정보를 데이터베이스 `user` 테이블과 매핑하는 엔티티입니다. 게시글의 작성자 역할을 합니다.
- **주요 메소드**: (Getter 외 특별한 비즈니스 메소드는 아직 없음)

#### 4. `BaseEntity.java`
- **파일 경로**: `src/main/java/com/busanit501/findmyfet/domain/BaseEntity.java`
- **기능 정의**: 데이터의 생성 시간(`createdAt`)과 수정 시간(`updatedAt`)을 자동으로 관리하기 위한 추상 클래스입니다. `Post`, `User` 등 여러 엔티티가 상속받아 사용합니다.

#### 5. Enums (`PostType.java`, `Status.java`, `Role.java`)
- **기능 정의**: 정해진 값(상수)만 사용하도록 강제하여 데이터의 일관성과 안정성을 높이는 열거형 타입입니다.
    - `PostType`: 게시글의 종류 ('찾아요' `MISSING`, '기다려요' `SHELTER`)
    - `Status`: 게시글의 상태 ('진행중' `ACTIVE`, '완료' `COMPLETED`)
    - `Role`: 사용자의 권한 ('일반사용자' `User`, '관리자' `Admin`)

### Ⅲ. 데이터 전송 객체 계층 (`DTO`)

#### 1. `PostCreateRequestDto.java`
- **기능 정의**: 게시글 생성을 위해 클라이언트(프론트엔드)로부터 받는 데이터를 담는 객체입니다.
- **주요 메소드**:
    - `toEntity()`: DTO 객체를 `Post` 엔티티 객체로 변환하여 DB에 저장할 수 있도록 합니다.

#### 2. `PostUpdateRequestDto.java`
- **기능 정의**: 게시글 수정을 위해 클라이언트로부터 받는 데이터를 담는 객체입니다. `deletedImageIds` 필드를 통해 삭제할 기존 이미지의 ID 목록을 받습니다.

#### 3. `PostListResponseDto.java`
- **기능 정의**: 게시글 목록 조회 시, 각 게시글의 요약 정보를 클라이언트에게 전달하기 위한 객체입니다.

#### 4. `PostDetailResponseDto.java`
- **기능 정의**: 게시글 상세 조회 시, 게시글의 모든 정보(이미지 URL, 작성자 정보 포함)를 클라이언트에게 전달하기 위한 객체입니다.

#### 5. `MyPostResponseDto.java`
- **기능 정의**: '내가 쓴 글' 목록 조회 시, API 명세에 맞는 특정 정보들을 클라이언트에게 전달하기 위한 객체입니다.

#### 6. `AuthorDto.java`
- **기능 정의**: 게시글의 작성자 정보(ID, 이름)를 외부에 안전하게 노출하기 위한 DTO입니다. 비밀번호 등 민감 정보를 제외하는 역할을 합니다.

### Ⅳ. 데이터 접근 계층 (`Repository`)

#### 1. `PostRepository.java`
- **기능 정의**: `Post` 엔티티에 대한 데이터베이스 CRUD 작업을 담당하는 인터페이스입니다.
- **주요 메소드**:
    - `findByUser_UseridOrderByCreatedAtDesc(Long userid)`: 특정 사용자가 작성한 모든 게시글을 최신순으로 조회하는 커스텀 쿼리 메소드입니다.

#### 2. `ImageRepository.java`, `UserRepository.java`
- **기능 정의**: 각각 `Image`, `User` 엔티티에 대한 기본적인 CRUD 작업을 위해 `JpaRepository`를 상속받는 인터페이스입니다.

### Ⅴ. 비즈니스 로직 계층 (`Service`)

#### 1. `PostService.java` (인터페이스)
- **기능 정의**: 게시글 관련 비즈니스 로직의 명세(설계도)입니다. `PostServiceImpl`이 구현해야 할 모든 기능(메소드)이 정의되어 있습니다.

#### 2. `PostServiceImpl.java` (구현체)
- **기능 정의**: `PostService` 인터페이스를 실제로 구현한 클래스로, 게시글 관련 모든 핵심 비즈니스 로직을 수행합니다.
- **주요 메소드**:
    - `createPost(...)`: 게시글 정보와 이미지 파일을 받아 DB에 저장하고, 업로드된 파일의 ID를 반환합니다.
    - `updatePost(...)`: 게시글을 수정합니다. 기존 이미지 삭제, 신규 이미지 추가, 텍스트 정보 변경 로직을 포함하며, JPA의 더티 체킹을 활용합니다.
    - `deletePost(...)`: 게시글과 연관된 이미지 파일 및 DB 데이터를 모두 삭제합니다.
    - `findPostById(...)`: 특정 게시글을 상세 조회합니다.
    - `findAllPosts()`: 모든 게시글 목록을 조회합니다.
    - `findMyPosts(...)`: 특정 사용자가 작성한 글 목록만 조회합니다.
    - `completePost(...)`: 게시글의 상태를 '완료'로 변경합니다.
    - `validatePostAuthorOrAdmin(...)`: 특정 작업을 수행하기 전, 현재 로그인한 사용자가 게시글의 작성자 본인이거나 관리자인지 권한을 검사하는 내부 메소드입니다.

#### 3. `FileUploadService.java` & `FileUploadServiceImpl.java`
- **기능 정의**: 이미지 파일의 물리적인 업로드 및 삭제를 처리하는 서비스입니다. 인터페이스와 구현체로 분리하여, 향후 AWS S3 등 다른 스토리지로 쉽게 교체할 수 있는 유연한 구조를 가집니다.

### Ⅵ. 프레젠테이션 계층 (`Controller`)

#### 1. `PostController.java`
- **기능 정의**: 게시글 관련 모든 HTTP 요청을 받아 처리하는 API 엔드포인트입니다. `PostService`를 호출하여 비즈니스 로직을 수행하고, 그 결과를 `ResponseEntity`에 담아 클라이언트에게 반환합니다.
- **주요 메소드 (API 엔드포인트)**:
    - `GET /api/posts`: 전체 게시글 목록 조회
    - `GET /api/posts/{postId}`: 특정 게시글 상세 조회
    - `POST /api/posts`: 신규 게시글 등록
    - `PUT /api/posts/{postId}`: 특정 게시글 수정
    - `DELETE /api/posts/{postId}`: 특정 게시글 삭제
    - `PUT /api/posts/{postId}/complete`: 찾기 완료 처리
    - `GET /api/posts/my`: 내가 쓴 글 목록 조회

---

## 2. 주요 논의사항 요약 (Q&A Summary)

#### Q1: `BaseEntity`의 `createdAt`과 DTO의 `createdAt`은 다른 변수인가?
- **요약**: 이름은 같지만 역할이 완전히 다른 별개의 변수입니다.
    - **Entity의 `createdAt`**: DB 테이블의 컬럼(`reg_date`)과 직접 매핑되며, Spring Data JPA가 **자동으로** 생성 시간을 기록하는 '원본 데이터'입니다.
    - **DTO의 `createdAt`**: 클라이언트에게 JSON 형태로 데이터를 전달하기 위한 '전달용 사본'입니다. Entity 객체로부터 값을 **수동으로 복사**하여 채워집니다.

#### Q2: `post.setUser(user)`가 호출되지 않는 이유는?
- **요약**: `Post.java` 엔티티 클래스 내부에 `setUser(User user)` 메소드가 **정의되어 있지 않았기 때문**입니다. `Post`와 `User`의 연관관계를 설정하는 해당 메소드를 `Post` 엔티티에 추가하여 문제를 해결했습니다.

#### Q3: `latitude` 필드 에러, 권한 검증 메소드 에러, 상세 조회 기능 누락 문제
- **요약**: 코드 통합 과정에서 발생한 여러 누락 사항들을 해결했습니다.
    - **필드 에러**: `Post` 엔티티와 관련 DTO에 `latitude`, `longitude` 필드 선언이 누락되어 추가했습니다.
    - **권한 검증 에러**: `PostServiceImpl` 내부에 권한 검증 로직을 수행하는 `validatePostAuthorOrAdmin` 메소드 정의가 누락되어 추가했습니다.
    - **상세 조회 누락**: 리팩토링 중 실수로 삭제되었던 `findPostById` 메소드를 `PostService`와 `PostServiceImpl`에 다시 추가하여 복구했습니다.

#### Q4: `Post.update()` 메소드의 파라미터 불일치 문제
- **요약**: 게시글 수정 시, `PostServiceImpl`에서 전달하는 모든 수정 필드(`animalAge` 등)를 `Post` 엔티티의 `update` 메소드가 모두 파라미터로 받을 수 있도록 시그니처를 일치시켜, **일부 필드만 수정되는 문제를 해결**했습니다.

#### Q5: 신규 요구사항: `location` 컬럼 추가 방안
- **요약**: 향후 사용될 `location`(잃어버린 장소) 필드를 시스템에 미리 반영했습니다.
    - `Post` 엔티티에 `private String location;` 필드를 추가했습니다.
    - `PostCreateRequestDto`, `PostUpdateRequestDto`, `PostDetailResponseDto` 등 관련 DTO에도 `location` 필드를 추가했습니다.
    - `Post` 엔티티의 `update` 메소드와 `PostCreateRequestDto`의 `toEntity` 빌더 로직에도 `location`을 반영하여 데이터가 정상적으로 처리되도록 조치했습니다.
